<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>dynatopGIS &amp; dynatop</title>

<script src="site_libs/header-attrs-2.9/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">dynatop Training</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Programme
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Getting Started</li>
    <li>
      <a href="prerequisite.html">Prerequisites</a>
    </li>
    <li class="dropdown-header">Background</li>
    <li>
      <a href="dynamic_topmodel.html">Dynamic TOPMODEL</a>
    </li>
    <li>
      <a href="dynatopGIS_dynatop.html">dynatopGIS &amp; dynatop</a>
    </li>
    <li>
      <a href="eden.html">Training Example</a>
    </li>
    <li class="dropdown-header">Building a Model</li>
    <li>
      <a href="initial_gis.html">Initial GIS Processing</a>
    </li>
    <li>
      <a href="observed_series.html">Processing Observed Data</a>
    </li>
    <li>
      <a href="model_building.html">Model Generation</a>
    </li>
    <li>
      <a href="resolution_complexity.html">Resolution &amp; Complexity</a>
    </li>
    <li class="dropdown-header">Running a model</li>
    <li>
      <a href="simulation.html">Setting up a Simulation</a>
    </li>
    <li>
      <a href="visualisation.html">Visualising the Output</a>
    </li>
    <li>
      <a href="monte_carlo.html">Monte-Carlo Runs</a>
    </li>
    <li class="dropdown-header">Developing dynatop</li>
    <li>
      <a href="using_github.html">Using github</a>
    </li>
    <li>
      <a href="package_structure.html">Package Structure</a>
    </li>
    <li>
      <a href="building_dynatop.html">Building dynatop</a>
    </li>
    <li>
      <a href="altering_dynatop.html">Altering dynatop</a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">dynatopGIS &amp; dynatop</h1>

</div>


<ul>
<li>opinionated implimentation of dynamic TOPMODEL concepts</li>
<li>Modular framework</li>
<li>OO to encase</li>
<li>flow diagram</li>
<li>what is implimented</li>
</ul>
<p>The <code>dynatop</code> package represents an implementation of the concepts behind a dynamic TOPMODEL. One of the underlying principles of dynamic TOPMODEL is that the landscape can be broken up into hydrologically similar regions, or Hydrological Response Units (HRUs), where all the area within a HRU behaves in a hydrologically similar fashion.</p>
<p>While a Hydrological Response Unit (HRU) has typically been thought of as an area of hill slope with, for example, similar topographic, soil and upslope area characteristics the idea may be generalised. In doing this a catchments is conceptualised as a collection of HRUs of different type (e.g. hill slope, channel, lake) which exchange fluxes at specified levels (e.g. saturated zone, surface)</p>
<p>As well as the exchange of fluxes this documents considers two types of HRU. The first termed “hillslope” solves the surface, root, unsaturated and saturated zones for ‘similar’ areas of hill slope the catchment a each time step. The second termed “channel” represents a length of river channel in a simplified manner allowing the extraction of the inflow from the hill slope. The solutions for each of these HRU types are presented in the <a href="hillslope_hru">hillslope</a> and <a href="channel">channel</a> vignettes.</p>
<p>The aim of this document is to outline</p>
<ul>
<li>the computational sequence and linking the HRUs</li>
<li>conventions for the input data</li>
<li>other miscellaneous information that may help developers</li>
</ul>
<div id="the-solution-order-of-hrus-and-exchange-of-fluxes" class="section level1">
<h1>The solution order of HRUs and exchange of fluxes</h1>
<p>Each HRU has a unique reference number in the <code>id</code> variable. In principle the HRUs are solved in reverse order of <code>id</code>; that is from the largest <code>id</code> value to the smallest. Currently this not strictly enforced since the C++ code used for the computation first solves the hillslope HRUs then the channel HRUs, but this should not be relied upon and may change in future releases.</p>
<p>Fluxes between the HRUs are represented as occurring at two levels, the surface and the saturated zones. For the <span class="math inline">\(i\)</span>th HRU the outflow in <span class="math inline">\(m^3/s\)</span> at time <span class="math inline">\(t+\Delta t\)</span> is <span class="math inline">\(\left.q_{sf}^{\left[i\right]}\right\rvert_{t+\Delta t}\)</span> at the surface and <span class="math inline">\(\left.q_{sz}^{\left[i\right]}\right\rvert_{t+\Delta t}\)</span> in the saturated zone.</p>
<p>The fraction of outflow going from the <span class="math inline">\(i\)</span> th to the <span class="math inline">\(j\)</span> th HRU is <span class="math inline">\(f_{i,j}\)</span>. The redistribution is conservative as does not vary in time so <span class="math display">\[
\sum\limits_{j} f_{i,j} = 1
\]</span> Since there is no exchange between the surface and saturated zones during redistribution the inflows at time <span class="math inline">\(t+\Delta t\)</span> to the <span class="math inline">\(k\)</span>th HRU can be computed as <span class="math display">\[
\sum\limits_{i&gt;k} f_{i,k}\left.q_{sf}^{\left[i\right]}\right\rvert_{t+\Delta t}
\]</span> and <span class="math display">\[
\sum\limits_{i&gt;k} f_{i,k}\left.q_{sz}^{\left[i\right]}\right\rvert_{t+\Delta t}
\]</span></p>
<p>The values of <span class="math inline">\(f_{i,j}\)</span> are specified in the <code>flow_direction</code> data.frame of the model.</p>
</div>
<div id="miscellaneous-coding-comments" class="section level1">
<h1>Miscellaneous Coding comments</h1>
<div id="relating-the-vignette-notation-and-code-variables" class="section level2">
<h2>Relating the vignette notation and code variables</h2>
<p>To aid the readability of the code the variables are labelled consistently with regards to the vignettes. For example:</p>
<ul>
<li>Single subscript: <span class="math inline">\(l_{sz}\)</span> becomes <code>l_sz</code>, <span class="math inline">\(s_{uz}\)</span> becomes <code>s_uz</code> etc</li>
<li>Directional variables: <span class="math inline">\(q_{rz \rightarrow uz}\)</span> becomes <code>q_rz_uz</code>, etc.</li>
<li>Greek letters are spelt: <span class="math inline">\(\lambda\)</span> becomes <code>lambda</code></li>
</ul>
<p>However the notation used in the vignettes for intermediate values of fluxes or states (e.g. ) is dropped from the code where it can be inferred from the computational sequence (or comments)</p>
</div>
<div id="numerical-solutions" class="section level2">
<h2>Numerical solutions</h2>
<p>Currently the code uses a purely implicit scheme for the solution of the hillslope HRUs. This requires a solving a <em>zero finding</em> problem for each HRU at each (sub)time step. Currently a simple bisection algorithm from the Boost math library is used. Notionally faster algorithms (such as the TOMS-748 algorithm) could be used, but initial experiments suggest that these sometimes fail to converge well enough to achieve a reasonable mass balance. This is probably due to poor specification of the starting interval.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
